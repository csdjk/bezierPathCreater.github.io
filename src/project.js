window.__require=function t(e,i,n){function o(r,c){if(!i[r]){if(!e[r]){var a=r.split("/");if(a=a[a.length-1],!e[a]){var h="function"==typeof __require&&__require;if(!c&&h)return h(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+r+"'")}}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){return o(e[r][1][t]||t)},u,u.exports,t,e,i,n)}return i[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<n.length;r++)o(n[r]);return o}({BezierMaker:[function(t,e,i){"use strict";cc._RF.push(e,"26c3bm8rXVNSaNaXJZojlpp","BezierMaker");e.exports=function(t){var e={},i=void 0,n=void 0,o=void 0,s=void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,c=t;function a(t){for(var e=1,i=1;i<=t;i++)e*=i;return e}var h=function(t,e){var r=s/e,h=0,u=0,v=c.length-1;c.forEach(function(t,e){e?(h+=a(v)/a(e)/a(v-e)*t.x*Math.pow(1-r,v-e)*Math.pow(r,e),u+=a(v)/a(e)/a(v-e)*t.y*Math.pow(1-r,v-e)*Math.pow(r,e)):(h+=t.x*Math.pow(1-r,v-e)*Math.pow(r,e),u+=t.y*Math.pow(1-r,v-e)*Math.pow(r,e))});var d=Math.sqrt(Math.pow(o.x-h,2)+Math.pow(o.y-u,2)),l={x:h,y:u,length:d};i.push(l),o=l,n+=d,s+=t};return e.getPoints=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;i=[],n=s=0,o={x:t[0].x,y:t[0].y,length:0};for(var c=r/e,a=0,u=e+1;a<u;a++)h(c,r);return i},e.getCurveLength=function(){return n},e},cc._RF.pop()},{}],bezier:[function(t,e,i){"use strict";cc._RF.push(e,"71193yWGTtKHaDpgThxbTip","bezier");e.exports=function(t,e,i){var n={},o=void 0,s=void 0,r=void 0,c=void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,h=t,u=e,v=i,d=function(t,e){var i=c/e,n=Math.pow(1-i,2)*h.x+2*i*(1-i)*u.x+Math.pow(i,2)*v.x,a=Math.pow(1-i,2)*h.y+2*i*(1-i)*u.y+Math.pow(i,2)*v.y,d=Math.sqrt(Math.pow(r.x-n,2)+Math.pow(r.y-a,2)),l={x:n,y:a,length:d};o.push(l),r=l,s+=d,c+=t};return n.getPoints=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;o=[],s=c=0,r={x:h.x,y:h.y,length:0};for(var e=a/t,i=0,n=t+1;i<n;i++)d(e,a);return o},n.getCurveLength=function(){return s},n},cc._RF.pop()},{}],drawBezier:[function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}cc._RF.push(e,"5f1e3Bvf/pIlrVZjlwy4M3n","drawBezier");var o=t("./bezier"),s=0,r=1,c=2,a=0;cc.Class({extends:cc.Component,properties:{graphicsNode:cc.Node,box:cc.Node,point:cc.Prefab,control:cc.Prefab,bezierColor:new cc.Color(255,0,0),lineColor:new cc.Color(0,255,255),infoWindow:cc.Node,runTime:cc.EditBox,msg:cc.Node,timeInfo:cc.Label,deleteBtn:cc.Node,mouseLocation:cc.Label},onLoad:function(){this.init()},init:function(){this.bezierLists=[],this.bezierCurveData={time:Number(this.runTime.string),length:0,points:[]},this.pointCurveDict=new Map,this.infoWindow.zIndex=10,this.notice=this.infoWindow.getChildByName("notice").getComponent(cc.Label),this.fileInputBox=this.infoWindow.getChildByName("Input").getChildByName("fileEditBox").getComponent(cc.EditBox),this.moveBtn=this.node.getChildByName("Input").getChildByName("moveBtn"),this.initGraphics(),this.initRandCurve(),this.initNodeEvents(),this.saveBezierPath(),this.hideInfoWindow(),this.addDeleteBtnEvents()},update:function(t){this.drawBezierAll(),this.isStartRun&&this.setCountTimeLabel(t)},initGraphics:function(){this.ctx=this.graphicsNode.getComponent(cc.Graphics),this.ctx.lineWidth=2},getRandPos:function(){var t=cc.view.getDesignResolutionSize(),e=Math.random()*t.width-.5*t.width,i=Math.random()*t.height-.5*t.height;return cc.v2(e,i)},initRandCurve:function(){var t=this.createPoint(s,this.getRandPos()),e=this.createPoint(r,this.getRandPos()),i=this.createPoint(s,this.getRandPos());this.moveTargetNode=null;var n={start:t,control:e,end:i};this.bezierLists.push(n),this.saveToPointCurveDict(n)},initNodeEvents:function(){this.addCanvasTouchEvents(),this.addDragEvents(this.box),this.addDragEvents(this.moveBtn,this.moveBtn.parent),this.addHideEvents(this.moveBtn.parent)},drawBezierAll:function(){this.ctx.clear();for(var t=0,e=this.bezierLists.length;t<e;t++){var i=this.bezierLists[t];this.drawBezier(i.start.position,i.control.position,i.end.position)}},drawBezier:function(t,e,i){this.ctx.moveTo(t.x,t.y),this.ctx.strokeColor=this.bezierColor,this.ctx.quadraticCurveTo(e.x,e.y,i.x,i.y),this.ctx.stroke(),this.ctx.moveTo(i.x,i.y),this.ctx.strokeColor=this.lineColor,this.ctx.lineTo(e.x,e.y),this.ctx.stroke()},isMove:function(t){return t.ident==s||t.ident==r||t.ident==c},isDelete:function(t){return t.ident==s},addHideEvents:function(t){var e=this;t.on(cc.Node.EventType.MOUSE_MOVE,function(t){e.hideMouseLocation()})},addDragEvents:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;t.on(cc.Node.EventType.MOUSE_DOWN,function(t){t.stopPropagation(),t.getButton()==cc.Event.EventMouse.BUTTON_LEFT&&e.isOperate()&&(e.moveTargetNode=i,e.isMouseDown=!0)}),t.on(cc.Node.EventType.MOUSE_MOVE,function(t){if(i.opacity=100,cc.game.canvas.style.cursor="all-scroll",e.isMouseDown&&e.moveTargetNode){var n=e.convertToNodeSpace(t);e.moveTargetNode.setPosition(n)}}),t.on(cc.Node.EventType.MOUSE_LEAVE,function(t){i.opacity=255,cc.game.canvas.style.cursor="auto"}),t.on(cc.Node.EventType.MOUSE_UP,function(t){e.isMouseDown=!1,e.moveTargetNode=null})},addPointDeleteEvents:function(t){var e=this;t.on(cc.Node.EventType.MOUSE_DOWN,function(t){if(t.getButton()!=cc.Event.EventMouse.BUTTON_RIGHT);else if(e.isDelete(t.target)){var i=e.convertToNodeSpace(t);e.deleteTarget=t.target,e.showDeleteBtn(i)}}),t.on(cc.Node.EventType.MOUSE_UP,function(){e.saveBezierPath()})},addCanvasTouchEvents:function(t){var e=this,i=void 0;this.node.on(cc.Node.EventType.MOUSE_DOWN,function(t){if(t.getButton()==cc.Event.EventMouse.BUTTON_LEFT){t.stopPropagation(),i=t.target;var n=e.convertToNodeSpace(t);if(!e.isOperate())return void console.log(i);e.createCurve(n),e.isMouseDown=!0}}),this.node.on(cc.Node.EventType.MOUSE_MOVE,function(t){i=t.target;var n=e.convertToNodeSpace(t);e.setMouseLocation(n),e.isMouseDown&&e.moveTargetNode&&e.moveTargetNode.setPosition(n)}),this.node.on(cc.Node.EventType.MOUSE_UP,function(t){i=t.target,e.isMouseDown=!1,e.moveTargetNode=null,e.isMove(i)&&e.saveBezierPath()})},createPoint:function(t,e){var i=void 0,n=void 0;t==s?((i=cc.instantiate(this.point)).ident=s,n="point"):t==r&&((i=cc.instantiate(this.control)).ident=r,n="control",this.moveTargetNode=i);var o=a++;i.name=n+"_"+o,i.parent=this.node,i.setPosition(e),this.addPointDeleteEvents(i),this.addDragEvents(i);var c=new cc.Node;return c.parent=i,c.y=20,c.addComponent(cc.Label).string=o,i},createCurve:function(t){var e=this.createPoint(s,t),i=this.createPoint(r,t),n={start:this.bezierLists[this.bezierLists.length-1].end,control:i,end:e};this.bezierLists.push(n),this.saveToPointCurveDict(n),console.log("bezierLists->",this.bezierLists)},saveToPointCurveDict:function(t){var e=void 0;for(var i in t){var n=t[i];(e=this.pointCurveDict.has(n)?this.pointCurveDict.get(n):{})[i+"Curve"]=t,this.pointCurveDict.set(n,e)}console.log("pointCurveDict",this.pointCurveDict)},convertToNodeSpace:function(t){return this.node.convertToNodeSpaceAR(t.getLocation())},addDeleteBtnEvents:function(){var t=this;this.deleteBtn.on(cc.Node.EventType.MOUSE_DOWN,function(e){if(e.stopPropagation(),e.getButton()==cc.Event.EventMouse.BUTTON_LEFT){if(t.bezierLists.length<=1)return void t.showMsg("\u4e0d\u80fd\u5220\u9664\u6700\u540e\u4e00\u4e2a\u66f2\u7ebf!!");t.deletePoint(),t.hideDeleteBtn(),t.saveBezierPath(),console.log("\u5220\u9664\u8282\u70b9bezierLists->",t.bezierLists),console.log("\u5220\u9664\u8282\u70b9pointCurveDict->",t.pointCurveDict)}})},getPointLocation:function(t){var e=this.pointCurveDict.get(t);if(e){if(e.startCurve&&e.endCurve)return"center";if(e.startCurve)return"start";if(e.endCurve)return"end"}return 0},deletePoint:function(){if(this.pointCurveDict.has(this.deleteTarget)){var t=this.getPointLocation(this.deleteTarget);"center"==t?this.deleteCenterPoint(this.deleteTarget):"start"==t?this.deleteStartPoint(this.deleteTarget):"end"==t&&this.deleteEndPoint(this.deleteTarget)}},deleteCenterPoint:function(t){if(console.warn("\u5220\u9664\u7684\u662f\u4e2d\u95f4\u70b9"),this.pointCurveDict.has(t)){var e=this.pointCurveDict.get(t),i=e.endCurve,n=e.startCurve;i.end=n.end,this.pointCurveDict.get(i.end).endCurve=i,this.pointCurveDict.delete(t),this.pointCurveDict.delete(n.start),this.pointCurveDict.delete(n.control),n.start.destroy(),n.control.destroy(),this.deleteCurveFromBezierLists(n)}},deleteStartPoint:function(t){if(console.warn("\u5220\u9664\u7684\u662f\u8d77\u70b9"),this.pointCurveDict.has(t)){var e=this.pointCurveDict.get(t),i=e.startCurve;e.endCurve=null,this.pointCurveDict.get(i.end).endCurve=null,this.pointCurveDict.delete(i.start),this.pointCurveDict.delete(i.control),i.start.destroy(),i.control.destroy(),this.deleteCurveFromBezierLists(i)}},deleteEndPoint:function(t){if(console.warn("\u5220\u9664\u7684\u662f\u7ec8\u70b9"),this.pointCurveDict.has(t)){var e=this.pointCurveDict.get(t),i=e.endCurve;e.startCurve=null,this.pointCurveDict.get(i.start).startCurve=null,this.pointCurveDict.delete(i.end),this.pointCurveDict.delete(i.control),i.end.destroy(),i.control.destroy(),this.deleteCurveFromBezierLists(i)}},deleteCurveFromBezierLists:function(t){for(var e=0,i=this.bezierLists.length;e<i;e++){if(this.bezierLists[e]===t)return void this.bezierLists.splice(e,1)}},saveBezierPath:function(){this.bezierCurveData.length=0,this.bezierCurveData.points=[],console.log("\u4fdd\u5b58\u8def\u5f84bezierLists",this.bezierLists);for(var t=0,e=this.bezierLists.length;t<e;t++){var i,s=this.bezierLists[t],r=new o(s.start,s.control,s.end,100),c=r.getPoints(100),a=r.getCurveLength();this.bezierCurveData.length+=a,(i=this.bezierCurveData.points).push.apply(i,n(c))}console.log("\u4fdd\u5b58\u8def\u5f84bezierCurveData",this.bezierCurveData),console.log("\u4fdd\u5b58\u8def\u5f84pointCurveDict->",this.pointCurveDict)},save:function(){""!=this.fileInputBox.string?this.checkRunTimeInputBox()?(this.setNoitce(""),this.computeBezierActions(),this.saveBezierPathToJson(this.fileInputBox.string)):this.showMsg("\u8fd0\u884c\u65f6\u95f4\u53ea\u80fd\u586b\u5199\u6570\u5b57\uff01\uff01\uff01"):this.setNoitce("\u6587\u4ef6\u540d\u4e0d\u80fd\u4e3a\u7a7a!")},saveBezierPathToJson:function(t){if(cc.sys.isBrowser){var e=JSON.stringify(this.bezierCurveData),i=new Blob([e],{type:"application/json"}),n=document.createElement("a");n.download=t,n.innerHTML="Download File",null!=window.webkitURL?n.href=window.webkitURL.createObjectURL(i):(n.href=window.URL.createObjectURL(i),n.onclick=destroyClickedElement,n.style.display="none",document.body.appendChild(n)),n.click()}},computeBezierActions:function(){this.actionLists=[];for(var t=0,e=this.bezierCurveData.points.length;t<e;t++){var i=this.bezierCurveData.points[t],n=i.length/this.bezierCurveData.length*this.bezierCurveData.time;i.time=n;var o=cc.moveTo(n,cc.v2(i.x,i.y));this.actionLists.push(o)}},playMoveAnimation:function(){var t,e=this;(this.computeBezierActions(),this.startCountTime(),console.time("time"),this.actionLists.push(cc.callFunc(function(){e.stopCountTime(),console.timeEnd("time")})),this.actionLists.length>1)?this.box.runAction(cc.sequence(this.actionLists)):(t=this.box).runAction.apply(t,n(this.actionLists))},checkRunTimeInputBox:function(){return""!=this.runTime.string&&!isNaN(Number(this.runTime.string))},setRunTime:function(){this.bezierCurveData.time=Number(this.runTime.string)},play:function(){this.checkRunTimeInputBox()?this.playMoveAnimation():this.showMsg("\u8fd0\u884c\u65f6\u95f4\u53ea\u80fd\u586b\u5199\u6570\u5b57\uff01\uff01\uff01")},showInfoWindow:function(){this.infoWindow.active=!0,this.setNoitce("")},hideInfoWindow:function(){this.infoWindow.active=!1},setNoitce:function(t){this.notice.string=t},showMsg:function(t){var e=this;this.msg.active=!0,this.msg.getComponent(cc.Label).string=t,setTimeout(function(){e.msg&&(e.msg.active=!1)},1e3)},startCountTime:function(){this.isStartRun=!0,this.timeInfo.string=0,this.currentRunTime=0},stopCountTime:function(){this.isStartRun=!1},setCountTimeLabel:function(t){this.currentRunTime=this.currentRunTime+t,this.timeInfo.string="run time: "+this.currentRunTime.toFixed(2)+"s"},isOperate:function(){return!this.deleteBtn.active||(this.hideDeleteBtn(),!1)},showDeleteBtn:function(t){this.deleteBtn.active=!0,this.deleteBtn.setPosition(t)},hideDeleteBtn:function(){this.deleteBtn.active=!1},setMouseLocation:function(t){this.mouseLocation.node.active=!0,this.mouseLocation.node.setPosition(t),this.mouseLocation.string="x:"+t.x+" y:"+t.y},hideMouseLocation:function(){this.mouseLocation.node.active=!1}}),cc._RF.pop()},{"./bezier":"bezier"}],test:[function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}cc._RF.push(e,"3c1aeFLOLRFrrQU9tFTJ/Kg","test");t("./bezier");var o=t("./BezierMaker"),s=0,r=1,c=2,a=0;cc.Class({extends:cc.Component,properties:{graphicsNode:cc.Node,box:cc.Node,point:cc.Prefab,control:cc.Prefab,bezierColor:new cc.Color(255,0,0),lineColor:new cc.Color(0,255,255),infoWindow:cc.Node,runTime:cc.EditBox,msg:cc.Node,timeInfo:cc.Label,deleteBtn:cc.Node,mouseLocation:cc.Label},onLoad:function(){this.init()},init:function(){this.bezierLists=[],this.bezierCurveData={time:Number(this.runTime.string),length:0,points:[]},this.pointCurveDict=new Map,this.infoWindow.zIndex=10,this.notice=this.infoWindow.getChildByName("notice").getComponent(cc.Label),this.fileInputBox=this.infoWindow.getChildByName("Input").getChildByName("fileEditBox").getComponent(cc.EditBox),this.inputNode=this.node.getChildByName("Input"),this.initGraphics(),this.initRandCurve(),this.initNodeEvents(),this.saveBezierPath(),this.hideInfoWindow(),this.addDeleteBtnEvents()},update:function(t){this.drawBezierAll(),this.isStartRun&&this.setCountTimeLabel(t)},initGraphics:function(){this.ctx=this.graphicsNode.getComponent(cc.Graphics),this.ctx.lineWidth=2},getRandPos:function(){var t=cc.view.getDesignResolutionSize(),e=Math.random()*t.width-.5*t.width,i=Math.random()*t.height-.5*t.height;return cc.v2(e,i)},initRandCurve:function(){var t=this.createPoint(s,this.getRandPos()),e=this.createPoint(r,this.getRandPos()),i=this.createPoint(s,this.getRandPos());this.moveTargetNode=null;var n={start:t,control:e,end:i};this.bezierLists.push(n),this.saveToPointCurveDict(n)},initNodeEvents:function(){this.addCanvasTouchEvents()},drawBezierAll:function(){this.ctx.clear();for(var t=0,e=this.bezierLists.length;t<e;t++){var i=this.bezierLists[t];this.drawBezier(i.start.position,i.control.position,i.end.position)}},drawBezier:function(t,e,i){this.ctx.moveTo(t.x,t.y),this.ctx.strokeColor=this.bezierColor,this.ctx.quadraticCurveTo(e.x,e.y,i.x,i.y),this.ctx.stroke(),this.ctx.moveTo(i.x,i.y),this.ctx.strokeColor=this.lineColor,this.ctx.lineTo(e.x,e.y),this.ctx.stroke()},isMove:function(t){return t.ident==s||t.ident==r||t.ident==c},isDelete:function(t){return t.ident==s},addTouchEvents:function(t){var e=this,i=void 0;t.on(cc.Node.EventType.MOUSE_DOWN,function(t){t.stopPropagation(),i=t.target;var n=e.convertToNodeSpace(t);t.getButton()!=cc.Event.EventMouse.BUTTON_RIGHT?e.isOperate()?(e.isMove(i)&&(e.moveTargetNode=i),e.isMouseDown=!0):console.log(i):e.isDelete(i)&&(e.deleteTarget=i,e.showDeleteBtn(n))}),t.on(cc.Node.EventType.MOUSE_MOVE,function(t){(i=t.target).opacity=100,cc.game.canvas.style.cursor="all-scroll";var n=e.convertToNodeSpace(t);e.setMouseLocation(n),e.isMouseDown&&e.moveTargetNode&&e.moveTargetNode.setPosition(n)}),t.on(cc.Node.EventType.MOUSE_LEAVE,function(t){(i=t.target).opacity=255,cc.game.canvas.style.cursor="auto"}),t.on(cc.Node.EventType.MOUSE_UP,function(t){i=t.target,e.isMouseDown=!1,e.moveTargetNode=null,e.saveBezierPath()})},addCanvasTouchEvents:function(t){var e=this,i=void 0;this.node.on(cc.Node.EventType.MOUSE_DOWN,function(t){t.stopPropagation(),i=t.target;var n=e.convertToNodeSpace(t);t.getButton()!=cc.Event.EventMouse.BUTTON_RIGHT&&(e.isOperate()?(e.createCurve(n),e.isMouseDown=!0):console.log(i))}),this.node.on(cc.Node.EventType.MOUSE_MOVE,function(t){i=t.target;var n=e.convertToNodeSpace(t);e.setMouseLocation(n),e.isMouseDown&&e.moveTargetNode&&e.moveTargetNode.setPosition(n)}),this.node.on(cc.Node.EventType.MOUSE_UP,function(t){i=t.target,e.isMouseDown=!1,e.moveTargetNode=null,e.isMove(i)&&e.saveBezierPath()})},createPoint:function(t,e){var i=void 0,n=void 0;t==s?((i=cc.instantiate(this.point)).ident=s,n="point"):t==r&&((i=cc.instantiate(this.control)).ident=r,n="control",this.moveTargetNode=i);var o=a++;i.name=n+"_"+o,i.parent=this.node,i.setPosition(e),this.addTouchEvents(i);var c=new cc.Node;return c.parent=i,c.y=20,c.addComponent(cc.Label).string=o,i},createCurve:function(t){var e=this.createPoint(s,t),i=this.createPoint(r,t),n={start:this.bezierLists[this.bezierLists.length-1].end,control:i,end:e};this.bezierLists.push(n),this.saveToPointCurveDict(n),console.log("bezierLists->",this.bezierLists)},saveToPointCurveDict:function(t){var e=void 0;for(var i in t){var n=t[i];(e=this.pointCurveDict.has(n)?this.pointCurveDict.get(n):{})[i+"Curve"]=t,this.pointCurveDict.set(n,e)}console.log("pointCurveDict",this.pointCurveDict)},convertToNodeSpace:function(t){return this.node.convertToNodeSpaceAR(t.getLocation())},addDeleteBtnEvents:function(){var t=this;this.deleteBtn.on(cc.Node.EventType.MOUSE_DOWN,function(e){if(e.stopPropagation(),e.getButton()==cc.Event.EventMouse.BUTTON_LEFT){if(t.bezierLists.length<=1)return void t.showMsg("\u4e0d\u80fd\u5220\u9664\u6700\u540e\u4e00\u4e2a\u66f2\u7ebf!!");t.deletePoint(),t.hideDeleteBtn(),t.saveBezierPath(),console.log("\u5220\u9664\u8282\u70b9bezierLists->",t.bezierLists),console.log("\u5220\u9664\u8282\u70b9pointCurveDict->",t.pointCurveDict)}})},getPointLocation:function(t){var e=this.pointCurveDict.get(t);if(e){if(e.startCurve&&e.endCurve)return"center";if(e.startCurve)return"start";if(e.endCurve)return"end"}return 0},deletePoint:function(){if(this.pointCurveDict.has(this.deleteTarget)){var t=this.getPointLocation(this.deleteTarget);"center"==t?this.deleteCenterPoint(this.deleteTarget):"start"==t?this.deleteStartPoint(this.deleteTarget):"end"==t&&this.deleteEndPoint(this.deleteTarget)}},deleteCenterPoint:function(t){if(console.warn("\u5220\u9664\u7684\u662f\u4e2d\u95f4\u70b9"),this.pointCurveDict.has(t)){var e=this.pointCurveDict.get(t),i=e.endCurve,n=e.startCurve;i.end=n.end,this.pointCurveDict.get(i.end).endCurve=i,this.pointCurveDict.delete(t),this.pointCurveDict.delete(n.start),this.pointCurveDict.delete(n.control),n.start.destroy(),n.control.destroy(),this.deleteCurveFromBezierLists(n)}},deleteStartPoint:function(t){if(console.warn("\u5220\u9664\u7684\u662f\u8d77\u70b9"),this.pointCurveDict.has(t)){var e=this.pointCurveDict.get(t),i=e.startCurve;e.endCurve=null,this.pointCurveDict.get(i.end).endCurve=null,this.pointCurveDict.delete(i.start),this.pointCurveDict.delete(i.control),i.start.destroy(),i.control.destroy(),this.deleteCurveFromBezierLists(i)}},deleteEndPoint:function(t){if(console.warn("\u5220\u9664\u7684\u662f\u7ec8\u70b9"),this.pointCurveDict.has(t)){var e=this.pointCurveDict.get(t),i=e.endCurve;e.startCurve=null,this.pointCurveDict.get(i.start).startCurve=null,this.pointCurveDict.delete(i.end),this.pointCurveDict.delete(i.control),i.end.destroy(),i.control.destroy(),this.deleteCurveFromBezierLists(i)}},deleteCurveFromBezierLists:function(t){for(var e=0,i=this.bezierLists.length;e<i;e++){if(this.bezierLists[e]===t)return void this.bezierLists.splice(e,1)}},saveBezierPath:function(){this.bezierCurveData.length=0,this.bezierCurveData.points=[],console.log("\u4fdd\u5b58\u8def\u5f84bezierLists",this.bezierLists);for(var t=0,e=this.bezierLists.length;t<e;t++){var i,s=this.bezierLists[t],r=new o([s.start,s.control,s.end],100),c=r.getPoints(100),a=r.getCurveLength();this.bezierCurveData.length+=a,(i=this.bezierCurveData.points).push.apply(i,n(c))}console.log("\u4fdd\u5b58\u8def\u5f84bezierCurveData",this.bezierCurveData),console.log("\u4fdd\u5b58\u8def\u5f84pointCurveDict->",this.pointCurveDict)},save:function(){""!=this.fileInputBox.string?this.checkRunTimeInputBox()?(this.setNoitce(""),this.computeBezierActions(),this.saveBezierPathToJson(this.fileInputBox.string)):this.showMsg("\u8fd0\u884c\u65f6\u95f4\u53ea\u80fd\u586b\u5199\u6570\u5b57\uff01\uff01\uff01"):this.setNoitce("\u6587\u4ef6\u540d\u4e0d\u80fd\u4e3a\u7a7a!")},saveBezierPathToJson:function(t){if(cc.sys.isBrowser){var e=JSON.stringify(this.bezierCurveData),i=new Blob([e],{type:"application/json"}),n=document.createElement("a");n.download=t,n.innerHTML="Download File",null!=window.webkitURL?n.href=window.webkitURL.createObjectURL(i):(n.href=window.URL.createObjectURL(i),n.onclick=destroyClickedElement,n.style.display="none",document.body.appendChild(n)),n.click()}},computeBezierActions:function(){this.actionLists=[];for(var t=0,e=this.bezierCurveData.points.length;t<e;t++){var i=this.bezierCurveData.points[t],n=i.length/this.bezierCurveData.length*this.bezierCurveData.time;i.time=n;var o=cc.moveTo(n,cc.v2(i.x,i.y));this.actionLists.push(o)}},playMoveAnimation:function(){var t,e=this;(this.computeBezierActions(),this.startCountTime(),console.time("time"),this.actionLists.push(cc.callFunc(function(){e.stopCountTime(),console.timeEnd("time")})),this.actionLists.length>1)?this.box.runAction(cc.sequence(this.actionLists)):(t=this.box).runAction.apply(t,n(this.actionLists))},checkRunTimeInputBox:function(){return""!=this.runTime.string&&!isNaN(Number(this.runTime.string))},setRunTime:function(){this.bezierCurveData.time=Number(this.runTime.string)},play:function(){this.checkRunTimeInputBox()?this.playMoveAnimation():this.showMsg("\u8fd0\u884c\u65f6\u95f4\u53ea\u80fd\u586b\u5199\u6570\u5b57\uff01\uff01\uff01")},showInfoWindow:function(){this.infoWindow.active=!0,this.setNoitce("")},hideInfoWindow:function(){this.infoWindow.active=!1},setNoitce:function(t){this.notice.string=t},showMsg:function(t){var e=this;this.msg.active=!0,this.msg.getComponent(cc.Label).string=t,setTimeout(function(){e.msg&&(e.msg.active=!1)},1e3)},startCountTime:function(){this.isStartRun=!0,this.timeInfo.string=0,this.currentRunTime=0},stopCountTime:function(){this.isStartRun=!1},setCountTimeLabel:function(t){this.currentRunTime=this.currentRunTime+t,this.timeInfo.string="run time: "+this.currentRunTime.toFixed(2)+"s"},isOperate:function(){return!this.deleteBtn.active||(this.hideDeleteBtn(),!1)},showDeleteBtn:function(t){this.deleteBtn.active=!0,this.deleteBtn.setPosition(t)},hideDeleteBtn:function(){this.deleteBtn.active=!1},setMouseLocation:function(t){this.mouseLocation.node.setPosition(t),this.mouseLocation.string="x:"+t.x+" y:"+t.y}}),cc._RF.pop()},{"./BezierMaker":"BezierMaker","./bezier":"bezier"}]},{},["BezierMaker","bezier","drawBezier","test"]);