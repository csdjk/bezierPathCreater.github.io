require=function s(r,c,h){function a(e,t){if(!c[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var o=c[e]={exports:{}};r[e][0].call(o.exports,function(t){return a(r[e][1][t]||t)},o,o.exports,s,r,c,h)}return c[e].exports}for(var u="function"==typeof require&&require,t=0;t<h.length;t++)a(h[t]);return a}({bezier:[function(t,e,i){"use strict";cc._RF.push(e,"71193yWGTtKHaDpgThxbTip","bezier");e.exports=function(t,e,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2,o={},u=void 0,l=void 0,d=void 0,v=void 0,p=n,f=t,g=e,C=i;return o.getPoints=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100;u=[],l=v=0,d={x:f.x,y:f.y,length:0};for(var e,i,n,o,s,r,c=p/t,h=0,a=t+1;h<a;h++)e=c,i=v/p,n=Math.pow(1-i,2)*f.x+2*i*(1-i)*g.x+Math.pow(i,2)*C.x,o=Math.pow(1-i,2)*f.y+2*i*(1-i)*g.y+Math.pow(i,2)*C.y,s=Math.sqrt(Math.pow(d.x-n,2)+Math.pow(d.y-o,2)),r={x:n,y:o,length:s},u.push(r),d=r,l+=s,v+=e;return u},o.getCurveLength=function(){return l},o},cc._RF.pop()},{}],drawBezier:[function(t,e,i){"use strict";function c(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}cc._RF.push(e,"5f1e3Bvf/pIlrVZjlwy4M3n","drawBezier");var h=t("./bezier"),o=0,s=1,n=2;cc.Class({extends:cc.Component,properties:{graphicsNode:cc.Node,box:cc.Node,point:cc.Prefab,control:cc.Prefab,bezierColor:cc.hexToColor("#03A8F3"),lineColor:cc.hexToColor("#e81e63"),infoWindow:cc.Node,runTime:cc.EditBox,msg:cc.Node,timeInfo:cc.Label,deleteBtn:cc.Node},onLoad:function(){this.init()},init:function(){this.bezierLists=[],this.bezierCurveData={time:Number(this.runTime.string),length:0,points:[]},this.pointCurveDict=new Map,this.infoWindow.zIndex=10,this.notice=this.infoWindow.getChildByName("notice").getComponent(cc.Label),this.fileInputBox=this.infoWindow.getChildByName("Input").getChildByName("fileEditBox").getComponent(cc.EditBox),this.inputNode=this.node.getChildByName("Input"),this.initGraphics(),this.initRandCurve(),this.initNodeEvents(),this.saveBezierPath(),this.hideInfoWindow(),this.addDeleteBtnEvents()},update:function(t){this.drawBezierAll(),this.isStartRun&&this.setCountTimeLabel(t)},initGraphics:function(){this.ctx=this.graphicsNode.getComponent(cc.Graphics),this.ctx.lineWidth=2},getRandPos:function(){var t=cc.view.getDesignResolutionSize(),e=Math.random()*t.width-.5*t.width,i=Math.random()*t.height-.5*t.height;return cc.v2(e,i)},initRandCurve:function(){var t=this.createPoint(o,this.getRandPos()),e=this.createPoint(s,this.getRandPos()),i=this.createPoint(o,this.getRandPos());this.moveTargetNode=null;var n={start:t,control:e,end:i};this.bezierLists.push(n),this.saveToPointCurveDict(n)},initNodeEvents:function(){this.addTouchEvents(this.node)},drawBezierAll:function(){this.ctx.clear();for(var t=0,e=this.bezierLists.length;t<e;t++){var i=this.bezierLists[t];this.drawBezier(i.start.position,i.control.position,i.end.position)}},drawBezier:function(t,e,i){this.ctx.moveTo(t.x,t.y),this.ctx.strokeColor=this.bezierColor,this.ctx.quadraticCurveTo(e.x,e.y,i.x,i.y),this.ctx.stroke(),this.ctx.moveTo(i.x,i.y),this.ctx.strokeColor=this.lineColor,this.ctx.lineTo(e.x,e.y),this.ctx.stroke()},isMove:function(t){return t.ident==o||t.ident==s||t.ident==n},isDelete:function(t){return t.ident==o},addTouchEvents:function(t){var i=this;t.on(cc.Node.EventType.MOUSE_DOWN,function(t){t.stopPropagation();var e=i.convertToNodeSpace(t);if(console.log(e),t.getButton()==cc.Event.EventMouse.BUTTON_RIGHT)return i.isDelete(this)&&(i.deleteTarget=this,i.showDeleteBtn(e)),void console.log(this);i.isOperate()?(i.isMove(this)&&(i.moveTargetNode=this),i.isMove(this)||i.moveTargetNode||i.createCurve(e),i.isMouseDown=!0):console.log(this)}),t.on(cc.Node.EventType.MOUSE_MOVE,function(t){i.isMove(this)&&(this.opacity=100,cc._canvas.style.cursor="all-scroll");var e=i.convertToNodeSpace(t);i.isMouseDown&&i.moveTargetNode&&i.moveTargetNode.setPosition(e)}),t.on(cc.Node.EventType.MOUSE_LEAVE,function(t){i.isMove(this)&&(this.opacity=255,cc._canvas.style.cursor="auto")}),t.on(cc.Node.EventType.MOUSE_UP,function(t){i.isMouseDown=!1,i.moveTargetNode=null,i.isMove(this)&&i.saveBezierPath()})},createPoint:function(t,e){var i=void 0;return t==o?((i=cc.instantiate(this.point)).ident=o,i.name="point"):t==s&&((i=cc.instantiate(this.control)).ident=s,i.name="control",this.moveTargetNode=i),i.parent=this.node,i.setPosition(e),this.addTouchEvents(i),i},createCurve:function(t){var e=this.createPoint(o,t),i=this.createPoint(s,t),n={start:this.bezierLists[this.bezierLists.length-1].end,control:i,end:e};this.bezierLists.push(n),this.saveToPointCurveDict(n),console.log("bezierLists->",this.bezierLists)},saveToPointCurveDict:function(t){var e=void 0;for(var i in t){var n=t[i];(e=this.pointCurveDict.has(n)?this.pointCurveDict.get(n):{})[i]=t,this.pointCurveDict.set(n,e)}console.log("pointCurveDict",this.pointCurveDict)},convertToNodeSpace:function(t){return this.node.convertToNodeSpaceAR(t.getLocation())},addDeleteBtnEvents:function(){var e=this;this.deleteBtn.on(cc.Node.EventType.MOUSE_DOWN,function(t){if(t.stopPropagation(),t.getButton()==cc.Event.EventMouse.BUTTON_LEFT){if(e.bezierLists.length<=1)return void e.showMsg("不能删除最后一个曲线!!");e.deletePoint(),e.hideDeleteBtn(),e.saveBezierPath(),console.log("删除节点bezierLists->",e.bezierLists),console.log("删除节点pointCurveDict->",e.pointCurveDict)}})},getPointLocation:function(t){var e=this.pointCurveDict.get(t);if(e){if(e.start&&e.end)return"center";if(e.start)return"start";if(e.end)return"end"}return 0},deletePoint:function(){if(this.pointCurveDict.has(this.deleteTarget)){var t=this.getPointLocation(this.deleteTarget);"center"==t?this.deleteCenterPoint(this.deleteTarget):"start"==t?this.deleteStartPoint(this.deleteTarget):"end"==t&&this.deleteEndPoint(this.deleteTarget)}},deleteCenterPoint:function(t){if(console.warn("删除的是中间点"),this.pointCurveDict.has(t)){var e=this.pointCurveDict.get(t),i=e.end,n=e.start;i.end=n.end,e.end=i,e.start=null,this.pointCurveDict.set(i.end,e),this.pointCurveDict.delete(n.start),this.pointCurveDict.delete(n.control),n.start.destroy(),n.control.destroy();for(var o=0,s=this.bezierLists.length;o<s;o++){if(n===this.bezierLists[o])return void this.bezierLists.splice(o,1)}}},deleteStartPoint:function(t){if(console.warn("删除的是起点"),this.pointCurveDict.has(t)){var e=this.pointCurveDict.get(t),i=e.start;e.end=null,this.pointCurveDict.delete(i.start),this.pointCurveDict.delete(i.control),i.start.destroy(),i.control.destroy();for(var n=0,o=this.bezierLists.length;n<o;n++){if(i===this.bezierLists[n])return void this.bezierLists.splice(n,1)}}},deleteEndPoint:function(t){if(console.warn("删除的是终点"),this.pointCurveDict.has(t)){var e=this.pointCurveDict.get(t),i=e.end;e.start=null,this.pointCurveDict.delete(i.end),this.pointCurveDict.delete(i.control),i.end.destroy(),i.control.destroy();for(var n=0,o=this.bezierLists.length;n<o;n++){if(i===this.bezierLists[n])return void this.bezierLists.splice(n,1)}}},saveBezierPath:function(){this.bezierCurveData.length=0,this.bezierCurveData.points=[],console.log("保存路径bezierLists",this.bezierLists);for(var t=0,e=this.bezierLists.length;t<e;t++){var i,n=this.bezierLists[t],o=new h(n.start,n.control,n.end,100),s=o.getPoints(100),r=o.getCurveLength();this.bezierCurveData.length+=r,(i=this.bezierCurveData.points).push.apply(i,c(s))}console.log("保存路径bezierCurveData",this.bezierCurveData),console.log("保存路径pointCurveDict->",this.pointCurveDict)},save:function(){""!=this.fileInputBox.string?this.checkRunTimeInputBox()?(this.setNoitce(""),this.computeBezierActions(),this.saveBezierPathToJson(this.fileInputBox.string)):this.showMsg("运行时间只能填写数字！！！"):this.setNoitce("文件名不能为空!")},saveBezierPathToJson:function(t){if(cc.sys.isBrowser){var e=JSON.stringify(this.bezierCurveData),i=new Blob([e],{type:"application/json"}),n=document.createElement("a");n.download=t,n.innerHTML="Download File",null!=window.webkitURL?n.href=window.webkitURL.createObjectURL(i):(n.href=window.URL.createObjectURL(i),n.onclick=destroyClickedElement,n.style.display="none",document.body.appendChild(n)),n.click()}},computeBezierActions:function(){this.actionLists=[];for(var t=0,e=this.bezierCurveData.points.length;t<e;t++){var i=this.bezierCurveData.points[t],n=i.length/this.bezierCurveData.length*this.bezierCurveData.time;i.time=n;var o=cc.moveTo(n,cc.v2(i.x,i.y));this.actionLists.push(o)}},playMoveAnimation:function(){var t,e=this;(this.computeBezierActions(),this.startCountTime(),console.time("time"),this.actionLists.push(cc.callFunc(function(){e.stopCountTime(),console.timeEnd("time")})),1<this.actionLists.length)?this.box.runAction(cc.sequence(this.actionLists)):(t=this.box).runAction.apply(t,c(this.actionLists))},checkRunTimeInputBox:function(){return""!=this.runTime.string&&!isNaN(Number(this.runTime.string))},setRunTime:function(){this.bezierCurveData.time=Number(this.runTime.string)},play:function(){this.checkRunTimeInputBox()?this.playMoveAnimation():this.showMsg("运行时间只能填写数字！！！")},showInfoWindow:function(){this.infoWindow.active=!0,this.setNoitce("")},hideInfoWindow:function(){this.infoWindow.active=!1},setNoitce:function(t){this.notice.string=t},showMsg:function(t){var e=this;this.msg.active=!0,this.msg.getComponent(cc.Label).string=t,setTimeout(function(){e.msg&&(e.msg.active=!1)},1e3)},startCountTime:function(){this.isStartRun=!0,this.timeInfo.string=0,this.currentRunTime=0},stopCountTime:function(){this.isStartRun=!1},setCountTimeLabel:function(t){this.currentRunTime=this.currentRunTime+t,this.timeInfo.string="run time: "+this.currentRunTime.toFixed(2)+"s"},isOperate:function(){return!this.deleteBtn.active||(this.hideDeleteBtn(),!1)},showDeleteBtn:function(t){this.deleteBtn.active=!0,this.deleteBtn.setPosition(t)},hideDeleteBtn:function(){this.deleteBtn.active=!1}}),cc._RF.pop()},{"./bezier":"bezier"}],test:[function(t,e,i){"use strict";cc._RF.push(e,"3c1aeFLOLRFrrQU9tFTJ/Kg","test"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.loader.loadRes("json/test.json",function(t,e){console.log(e),console.log(JSON.parse(e))})}}),cc._RF.pop()},{}]},{},["bezier","drawBezier","test"]);