require=function s(r,c,h){function a(e,t){if(!c[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(u)return u(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var n=c[e]={exports:{}};r[e][0].call(n.exports,function(t){return a(r[e][1][t]||t)},n,n.exports,s,r,c,h)}return c[e].exports}for(var u="function"==typeof require&&require,t=0;t<h.length;t++)a(h[t]);return a}({bezier:[function(t,e,i){"use strict";cc._RF.push(e,"71193yWGTtKHaDpgThxbTip","bezier");e.exports=function(t,e,i){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2,n={},u=void 0,d=void 0,l=void 0,v=void 0,p=o,f=t,m=e,g=i;return n.getPoints=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100;u=[],d=v=0,l={x:f.x,y:f.y,length:0};for(var e,i,o,n,s,r,c=p/t,h=0,a=t+1;h<a;h++)e=c,i=v/p,o=Math.pow(1-i,2)*f.x+2*i*(1-i)*m.x+Math.pow(i,2)*g.x,n=Math.pow(1-i,2)*f.y+2*i*(1-i)*m.y+Math.pow(i,2)*g.y,s=Math.sqrt(Math.pow(l.x-o,2)+Math.pow(l.y-n,2)),r={x:o,y:n,length:s},u.push(r),l=r,d+=s,v+=e;return u},n.getCurveLength=function(){return d},n},cc._RF.pop()},{}],myBezier:[function(t,e,i){"use strict";function c(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}cc._RF.push(e,"5f1e3Bvf/pIlrVZjlwy4M3n","myBezier");var h=t("./bezier"),n=0,s=1,o=2;cc.Class({extends:cc.Component,editor:{executeInEditMode:!0},properties:{graphicsNode:cc.Node,box:cc.Node,point:cc.Prefab,control:cc.Prefab,bezierColor:cc.hexToColor("#03A8F3"),lineColor:cc.hexToColor("#e81e63"),startNode:cc.Node,controlNode:cc.Node,endNode:cc.Node,infoWindow:cc.Node,runTime:cc.EditBox,msg:cc.Node,timeInfo:cc.Label},onLoad:function(){this.bezierLists=[],this.bezierCurveData={time:Number(this.runTime.string),length:0,points:[]},this.notice=this.infoWindow.getChildByName("notice").getComponent(cc.Label),this.fileInputBox=this.infoWindow.getChildByName("Input").getChildByName("fileEditBox").getComponent(cc.EditBox),this.inputNode=this.node.getChildByName("Input"),this.initGraphics(),this.initCurveLists(),this.initNodeEvents(),this.saveBezierPath(),this.hideInfoWindow()},update:function(t){this.drawBezierAll(),this.isStartRun&&this.setCountTimeLabel(t)},initGraphics:function(){this.ctx=this.graphicsNode.getComponent(cc.Graphics),this.ctx.lineWidth=2},initCurveLists:function(){this.bezierLists.push({start:this.startNode,control:this.controlNode,end:this.endNode})},initNodeEvents:function(){this.addTouchEvents(this.node),this.startNode.ident=n,this.addTouchEvents(this.startNode),this.controlNode.ident=s,this.addTouchEvents(this.controlNode),this.endNode.ident=n,this.addTouchEvents(this.endNode)},drawBezierAll:function(){this.ctx.clear();for(var t=0,e=this.bezierLists.length;t<e;t++){var i=this.bezierLists[t];this.drawBezier(i.start.position,i.control.position,i.end.position)}},drawBezier:function(t,e,i){this.ctx.moveTo(t.x,t.y),this.ctx.strokeColor=this.bezierColor,this.ctx.quadraticCurveTo(e.x,e.y,i.x,i.y),this.ctx.stroke(),this.ctx.moveTo(i.x,i.y),this.ctx.strokeColor=this.lineColor,this.ctx.lineTo(e.x,e.y),this.ctx.stroke()},isMove:function(t){return t.ident==n||t.ident==s||t.ident==o},addTouchEvents:function(t){var i=this;t.on(cc.Node.EventType.MOUSE_DOWN,function(t){var e=i.convertToNodeSpace(t);this.isMouseDown=!0,console.log(this),i.isMove(this)&&(i.moveTargetNode=this),i.isMove(this)||i.moveTargetNode||i.createCurve(e)}),t.on(cc.Node.EventType.MOUSE_MOVE,function(t){i.isMove(this)&&(this.opacity=100,cc._canvas.style.cursor="all-scroll");var e=i.convertToNodeSpace(t);this.isMouseDown&&i.moveTargetNode&&i.moveTargetNode.setPosition(e)}),t.on(cc.Node.EventType.MOUSE_LEAVE,function(t){i.isMove(this)&&(this.opacity=255,cc._canvas.style.cursor="auto")}),t.on(cc.Node.EventType.MOUSE_UP,function(t){this.isMouseDown=!1,i.moveTargetNode=null,i.isMove(this)&&i.saveBezierPath()})},createCurve:function(t){var e=cc.instantiate(this.point);e.parent=this.node,e.ident=n,e.setPosition(t),this.addTouchEvents(e);var i=cc.instantiate(this.control);i.parent=this.node,i.ident=s,i.setPosition(t),i.isMouseDown=!0,this.addTouchEvents(i),this.moveTargetNode=i;var o={start:this.bezierLists[this.bezierLists.length-1].end,control:i,end:e};this.bezierLists.push(o)},convertToNodeSpace:function(t){return this.node.convertToNodeSpaceAR(t.getLocation())},saveBezierPath:function(){this.bezierCurveData.length=0,this.bezierCurveData.points=[];for(var t=0,e=this.bezierLists.length;t<e;t++){var i,o=this.bezierLists[t],n=new h(o.start,o.control,o.end,100),s=n.getPoints(100),r=n.getCurveLength();this.bezierCurveData.length+=r,(i=this.bezierCurveData.points).push.apply(i,c(s)),console.log("points",s),console.log("bezierCurveData",this.bezierCurveData)}},save:function(){""!=this.fileInputBox.string?this.checkRunTimeInputBox()?(this.setNoitce(""),this.computeBezierActions(),this.saveBezierPathToJson(this.fileInputBox.string)):this.showMsg("运行时间只能填写数字！！！"):this.setNoitce("文件名不能为空!")},saveBezierPathToJson:function(t){if(console.log("保存"),cc.sys.isBrowser){console.log("保存",this.bezierCurveData);var e=JSON.stringify(this.bezierCurveData);console.log("保存",e);var i=new Blob([e],{type:"application/json"}),o=document.createElement("a");o.download=t,o.innerHTML="Download File",null!=window.webkitURL?o.href=window.webkitURL.createObjectURL(i):(o.href=window.URL.createObjectURL(i),o.onclick=destroyClickedElement,o.style.display="none",document.body.appendChild(o)),o.click()}},computeBezierActions:function(){this.actionLists=[];for(var t=0,e=this.bezierCurveData.points.length;t<e;t++){var i=this.bezierCurveData.points[t],o=i.length/this.bezierCurveData.length*this.bezierCurveData.time;i.time=o;var n=cc.moveTo(o,cc.v2(i.x,i.y));this.actionLists.push(n)}},playMoveAnimation:function(){var t,e=this;(this.computeBezierActions(),this.startCountTime(),console.time("time"),this.actionLists.push(cc.callFunc(function(){e.stopCountTime(),console.timeEnd("time")})),1<this.actionLists.length)?this.box.runAction(cc.sequence(this.actionLists)):(t=this.box).runAction.apply(t,c(this.actionLists))},checkRunTimeInputBox:function(){return""!=this.runTime.string&&!isNaN(Number(this.runTime.string))},setRunTime:function(){this.bezierCurveData.time=Number(this.runTime.string)},play:function(){this.checkRunTimeInputBox()?this.playMoveAnimation():this.showMsg("运行时间只能填写数字！！！")},showInfoWindow:function(){this.infoWindow.active=!0,this.setNoitce("")},hideInfoWindow:function(){this.infoWindow.active=!1},setNoitce:function(t){this.notice.string=t},showMsg:function(t){var e=this;this.msg.active=!0,this.msg.getComponent(cc.Label).string=t,setTimeout(function(){e.msg&&(e.msg.active=!1)},1e3)},startCountTime:function(){this.isStartRun=!0,this.timeInfo.string=0,this.currentRunTime=0},stopCountTime:function(){this.isStartRun=!1},setCountTimeLabel:function(t){this.currentRunTime=this.currentRunTime+t,this.timeInfo.string="run time: "+this.currentRunTime.toFixed(2)+"s"}}),cc._RF.pop()},{"./bezier":"bezier"}],test:[function(t,e,i){"use strict";cc._RF.push(e,"3c1aeFLOLRFrrQU9tFTJ/Kg","test"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.loader.loadRes("json/test.json",function(t,e){console.log(e),console.log(JSON.parse(e))})}}),cc._RF.pop()},{}]},{},["bezier","myBezier","test"]);