window.__require=function t(e,n,i){function o(s,c){if(!n[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var l="function"==typeof __require&&__require;if(!c&&l)return l(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var u=n[s]={exports:{}};e[s][0].call(u.exports,function(t){return o(e[s][1][t]||t)},u,u.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<i.length;s++)o(i[s]);return o}({BezierData:[function(t,e,n){"use strict";function i(t){return s(t)||r(t)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function r(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function s(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}cc._RF.push(e,"0bdd4Tm8mxMCLzyMc12Tebc","BezierData");var c=t("Bezier"),a=function(){var t={},e=null,n=null,o=[],r={time:2,length:0,points:[]},s=new Map,l=null,u=0,h=null,d=2,v=100,f={width:1920,height:1080};t.init=function(t,i,o){this.clearAllBezier(),e=t,n=i,h=o,B()},t.getResolution=function(t){return f},t.setResolution=function(t,e){return f={width:t,height:e}},t.setPointCount=function(t){v=t},t.setBezierCurveType=function(t){d=t},t.setDeleteTarget=function(t){l=t},t.addBezierCurve=function(t){o.push(t),console.log("bezierCurveLists",o)},t.getBezierCurveType=function(){return d},t.getBezierCurveLists=function(){return o},t.getBezierCurveData=function(){return r},t.setBezierCurveRunTime=function(t){r.time=t},t.isLastCurve=function(){return o.length<=1},t.createCurve=function(t){var e=p(lcl.Ident.point,t),n=p(lcl.Ident.control,t),i={start:o[o.length-1].end,control:n,end:e};o.push(i),this.saveToPointCurveDict(i),console.log("bezierLists->",o)},t.createThirdOrderCurve=function(t){var e=o[o.length-1].end,n=p(lcl.Ident.point,t),i=p(lcl.Ident.control,t),r=cc.v2(200,200).add(e.position);r.x=Math.min(f.width/2,r.x),r.y=Math.min(f.height/2,r.y);var s={start:e,control1:p(lcl.Ident.control,r,!1),control2:i,end:n};o.push(s),this.saveToPointCurveDict(s),console.log("bezierLists->",o)},t.saveToPointCurveDict=function(t){var e;for(var n in t){var i=t[n];(e=s.has(i)?s.get(i):{})[n+"Curve"]=t,s.set(i,e)}console.log("pointCurveDict",s)},t.deletePoint=function(){if(s.has(l)){var t=m(l);"center"==t?C(l):"start"==t?w(l):"end"==t&&E(l)}},t.saveBezierPath=function(){r.length=0,r.points=[],console.log("\u4fdd\u5b58\u8def\u5f84bezierLists",o);for(var t=0,e=o.length;t<e;t++){var n,a=o[t],l=new c(Object.values(a),2),u=l.getPoints(v);console.log("consscscds",v);var h=l.getCurveLength();r.length+=h,(n=r.points).push.apply(n,i(u))}console.log("\u4fdd\u5b58\u8def\u5f84bezierCurveData",r),console.log("\u4fdd\u5b58\u8def\u5f84pointCurveDict->",s)},t.clearAllBezier=function(){console.log("clearAllBezier"),o=[],s.forEach(function(t,e){e&&e.destroy()}),s.clear()};var p=function(t,i){var o,r,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t==lcl.Ident.point?((o=cc.instantiate(e)).ident=lcl.Ident.point,r="point"):t==lcl.Ident.control&&((o=cc.instantiate(n)).ident=lcl.Ident.control,r="control",s&&lcl.NodeEvents.setMoveTargetNode(o));var c=u++;o.name=r+"_"+c,o.parent=h,o.setPosition(i),lcl.NodeEvents.addPointDeleteEvents(o),lcl.NodeEvents.addDragEvents(o);var a=new cc.Node;return a.parent=o,a.y=20,a.addComponent(cc.Label).string=c,o},g=function(){var t=Math.random()*f.width-.5*f.width,e=Math.random()*f.height-.5*f.height;return cc.v2(t,e)},B=function(){var t=p(lcl.Ident.point,g()),e=p(lcl.Ident.control,g()),n=p(lcl.Ident.point,g());lcl.NodeEvents.setMoveTargetNode(null);var i={start:t,control:e,end:n};a.addBezierCurve(i),a.saveToPointCurveDict(i)},m=function(t){var e=s.get(t);if(e){if(e.startCurve&&e.endCurve)return"center";if(e.startCurve)return"start";if(e.endCurve)return"end"}return 0},C=function(t){if(console.warn("\u5220\u9664\u7684\u662f\u4e2d\u95f4\u70b9"),s.has(t)){var e=s.get(t),n=e.endCurve,i=e.startCurve;n.end=i.end;var o=s.get(n.end);for(var r in o.endCurve=n,s.delete(t),i)if("end"!=r){var c=i[r];s.delete(c),c.destroy()}y(i)}},w=function(t){if(console.warn("\u5220\u9664\u7684\u662f\u8d77\u70b9"),s.has(t)){var e=s.get(t),n=e.startCurve;e.endCurve=null;var i=s.get(n.end);for(var o in i.endCurve=null,n)if("end"!=o){var r=n[o];s.delete(r),r.destroy()}y(n)}},E=function(t){if(console.warn("\u5220\u9664\u7684\u662f\u7ec8\u70b9"),s.has(t)){var e=s.get(t),n=e.endCurve;e.startCurve=null;var i=s.get(n.start);for(var o in i.startCurve=null,n)if("start"!=o){var r=n[o];s.delete(r),r.destroy()}y(n)}},y=function(t){for(var e=0,n=o.length;e<n;e++){if(o[e]===t)return void o.splice(e,1)}};return t}();e.exports=a,cc._RF.pop()},{Bezier:"Bezier"}],Bezier:[function(t,e,n){"use strict";cc._RF.push(e,"d039dqa1TtIq7lmvTjJ9ncx","Bezier");e.exports=function(t){var e,n,i,o,r={},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,c=t;function a(t){for(var e=1,n=1;n<=t;n++)e*=n;return e}var l=function(t,r){var s=o/r,l=0,u=0,h=c.length-1;c.forEach(function(t,e){e?(l+=a(h)/a(e)/a(h-e)*t.x*Math.pow(1-s,h-e)*Math.pow(s,e),u+=a(h)/a(e)/a(h-e)*t.y*Math.pow(1-s,h-e)*Math.pow(s,e)):(l+=t.x*Math.pow(1-s,h-e)*Math.pow(s,e),u+=t.y*Math.pow(1-s,h-e)*Math.pow(s,e))});var d=Math.sqrt(Math.pow(i.x-l,2)+Math.pow(i.y-u,2)),v={x:l,y:u,length:d};e.push(v),i=v,n+=d,o+=t};return r.getPoints=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;e=[],n=o=0,i={x:t[0].x,y:t[0].y,length:0};for(var c=s/r,a=0,u=r+1;a<u;a++)l(c,s);return e},r.getCurveLength=function(){return n},r},cc._RF.pop()},{}],Enum:[function(t,e,n){"use strict";cc._RF.push(e,"c328dsGctNCsqdKLfSajdEf","Enum"),e.exports={Ident:{point:0,control:1,window:2},BezierCurveType:{SecondOrder:2,ThirdOrder:3}},cc._RF.pop()},{}],EventListener:[function(t,e,n){"use strict";cc._RF.push(e,"79eceW6rG9Hza7PDc4t2EIb","EventListener");var i=function(){var t={},e={};return t.on=function(t,n){e[t]=e[t]||[],e[t].push(n)},t.emit=function(t,n){if(e[t])for(var i=0,o=e[t].length;i<o;i++)e[t][i].call(null,n)},t.off=function(t,n){for(var i=e[t],o=0,r=i.length;o<r;o++)i[o]===n&&i.splice(o,1)},t}();e.exports=i,cc._RF.pop()},{}],NodeEvents:[function(t,e,n){"use strict";cc._RF.push(e,"09ffeHRa95D+4fI4+Flx7Mh","NodeEvents");var i=function(){var t={},e=null,n=null,i=!0;function o(t){return cc.find("Canvas").convertToNodeSpaceAR(t.getLocation())}function r(t){return t.ident==lcl.Ident.point}function s(t){var e=lcl.BezierData.getResolution(),n=e.width/2,i=e.height/2;return t.x>-n&&t.x<n&&t.y>-i&&t.y<i}function c(t,e){var n=!1;switch(e.ident){case lcl.Ident.point:case lcl.Ident.control:n=s(t);break;case lcl.Ident.window:n=!0}return console.log(e.name,e.ident),n}return t.setMoveTargetNode=function(t){e=t},t.setOperateStatus=function(t){i=t},t.addDragEvents=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;t.on(cc.Node.EventType.MOUSE_DOWN,function(t){t.stopPropagation(),t.getButton()==cc.Event.EventMouse.BUTTON_LEFT&&(e=i,n=!0)}),t.on(cc.Node.EventType.MOUSE_MOVE,function(t){if(i.opacity=100,cc.game.canvas.style.cursor="all-scroll",n&&e){var r=o(t);c(r,e)&&e.setPosition(r)}}),t.on(cc.Node.EventType.MOUSE_LEAVE,function(t){i.opacity=255,cc.game.canvas.style.cursor="auto"}),t.on(cc.Node.EventType.MOUSE_UP,function(t){n=!1,e=null,lcl.BezierData.saveBezierPath()})},t.addPointDeleteEvents=function(t){t.on(cc.Node.EventType.MOUSE_DOWN,function(t){if(t.getButton()!=cc.Event.EventMouse.BUTTON_RIGHT);else if(r(t.target)){var e=o(t);lcl.BezierData.setDeleteTarget(t.target),lcl.Events.emit("showDeleteBtn",e)}})},t.addCanvasTouchEvents=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cc.find("Canvas");t.on(cc.Node.EventType.MOUSE_DOWN,function(t){if(t.getButton()==cc.Event.EventMouse.BUTTON_LEFT){t.stopPropagation(),t.target;var e=o(t);if(!s(e))return;i||lcl.Events.emit("hideDeleteBtn"),lcl.BezierData.getBezierCurveType()==lcl.BezierCurveType.SecondOrder&&lcl.BezierData.createCurve(e),lcl.BezierData.getBezierCurveType()==lcl.BezierCurveType.ThirdOrder&&lcl.BezierData.createThirdOrderCurve(e),n=!0}}),t.on(cc.Node.EventType.MOUSE_MOVE,function(t){t.target;var i=o(t);lcl.Events.emit("setMouseLocation",i),n&&e&&c(i,e)&&(console.log("moveTargetNode.setPosition(mousePos);"),e.setPosition(i))}),t.on(cc.Node.EventType.MOUSE_UP,function(t){t.target,n=!1,e=null})},t}();e.exports=i,cc._RF.pop()},{}],drawBezier:[function(t,e,n){"use strict";function i(t){return s(t)||r(t)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function r(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function s(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}cc._RF.push(e,"3c1aeFLOLRFrrQU9tFTJ/Kg","drawBezier"),window.lcl={},window.lcl.Bezier=t("./Bezier"),window.lcl.BezierData=t("./BezierData"),window.lcl.NodeEvents=t("./NodeEvents"),window.lcl.Events=t("./EventListener"),window.lcl.Ident=t("./Enum").Ident,window.lcl.BezierCurveType=t("./Enum").BezierCurveType,cc.Class({extends:cc.Component,properties:{graphicsNode:cc.Node,box:cc.Node,point:cc.Prefab,control:cc.Prefab,bezierColor:new cc.Color(255,0,0),lineColor:new cc.Color(0,255,255),infoWindow:cc.Node,paper:cc.Node,msg:cc.Node,timeInfo:cc.Label,deleteBtn:cc.Node,mouseLocation:cc.Label},onLoad:function(){this.init(),lcl.Events.on("setMouseLocation",this.setMouseLocation.bind(this)),lcl.Events.on("showDeleteBtn",this.showDeleteBtn.bind(this)),lcl.Events.on("hideDeleteBtn",this.hideDeleteBtn.bind(this))},init:function(){this.infoWindow.zIndex=10,this.notice=this.infoWindow.getChildByName("notice").getComponent(cc.Label),this.fileInputBox=this.infoWindow.getChildByName("Input").getChildByName("fileEditBox").getComponent(cc.EditBox);var t=this.node.getChildByName("controlPanel");this.moveBtn=t.getChildByName("moveBtn"),this.smoothnessInputBox=t.getChildByName("smoothnessInput").getChildByName("EditBox").getComponent(cc.EditBox),this.runTimeInputBox=t.getChildByName("runTimeInput").getChildByName("EditBox").getComponent(cc.EditBox),this.resolutionWidthInputBox=t.getChildByName("resolution").getChildByName("width").getComponent(cc.EditBox),this.resolutionHeightInputBox=t.getChildByName("resolution").getChildByName("height").getComponent(cc.EditBox),this.initGraphics(),this.initNodeEvents(),this.hideInfoWindow(),this.addDeleteBtnEvents(),this.initResolution(),lcl.BezierData.init(this.point,this.control,this.node),lcl.BezierData.setBezierCurveRunTime(Number(this.runTimeInputBox.string)),lcl.BezierData.saveBezierPath()},update:function(t){lcl.NodeEvents.setOperateStatus(!this.deleteBtn.active),this.drawBezierAll(),this.isStartRun&&this.setCountTimeLabel(t)},initResolution:function(){this.resolution=lcl.BezierData.getResolution(),this.resolutionWidthInputBox.string=this.resolution.width,this.resolutionHeightInputBox.string=this.resolution.height,this.setPaperSize()},initGraphics:function(){this.ctx=this.graphicsNode.getComponent(cc.Graphics),this.ctx.lineWidth=2},initNodeEvents:function(){lcl.NodeEvents.addCanvasTouchEvents(),this.box.ident=lcl.Ident.window,this.moveBtn.ident=lcl.Ident.window,this.moveBtn.parent.ident=lcl.Ident.window,lcl.NodeEvents.addDragEvents(this.box),lcl.NodeEvents.addDragEvents(this.moveBtn,this.moveBtn.parent),this.addHideEvents(this.moveBtn.parent)},drawBezierAll:function(){this.ctx.clear();for(var t=lcl.BezierData.getBezierCurveLists(),e=0,n=t.length;e<n;e++){var i=t[e],o=Object.keys(i).length;3==o&&this.drawBezier(i.start.position,i.control.position,i.end.position),4==o&&this.drawThirdOrderBezier(i)}},drawBezier:function(t,e,n){this.ctx.moveTo(t.x,t.y),this.ctx.strokeColor=this.bezierColor,this.ctx.quadraticCurveTo(e.x,e.y,n.x,n.y),this.ctx.stroke(),this.ctx.moveTo(n.x,n.y),this.ctx.strokeColor=this.lineColor,this.ctx.lineTo(e.x,e.y),this.ctx.stroke()},drawThirdOrderBezier:function(t){this.ctx.moveTo(t.start.x,t.start.y),this.ctx.strokeColor=this.bezierColor,this.ctx.bezierCurveTo(t.control1.x,t.control1.y,t.control2.x,t.control2.y,t.end.x,t.end.y),this.ctx.stroke(),this.ctx.moveTo(t.start.x,t.start.y),this.ctx.strokeColor=this.lineColor,this.ctx.lineTo(t.control1.x,t.control1.y),this.ctx.stroke(),this.ctx.moveTo(t.end.x,t.end.y),this.ctx.lineTo(t.control2.x,t.control2.y),this.ctx.stroke()},addHideEvents:function(t){var e=this;t.on(cc.Node.EventType.MOUSE_MOVE,function(t){e.hideMouseLocation()})},convertToNodeSpace:function(t){return this.node.convertToNodeSpaceAR(t.getLocation())},addDeleteBtnEvents:function(){var t=this;this.deleteBtn.on(cc.Node.EventType.MOUSE_DOWN,function(e){if(e.stopPropagation(),e.getButton()==cc.Event.EventMouse.BUTTON_LEFT){if(lcl.BezierData.isLastCurve())return void t.showMsg("\u4e0d\u80fd\u5220\u9664\u6700\u540e\u4e00\u4e2a\u66f2\u7ebf!!");t.hideDeleteBtn(),lcl.BezierData.deletePoint(),lcl.BezierData.saveBezierPath()}})},save:function(){""!=this.fileInputBox.string?(this.setNoitce(""),this.computeBezierActions(),this.saveBezierPathToJson(this.fileInputBox.string)):this.setNoitce("\u6587\u4ef6\u540d\u4e0d\u80fd\u4e3a\u7a7a!")},saveBezierPathToJson:function(t){if(cc.sys.isBrowser){var e=JSON.stringify(lcl.BezierData.getBezierCurveData()),n=new Blob([e],{type:"application/json"}),i=document.createElement("a");i.download=t,i.innerHTML="Download File",null!=window.webkitURL?i.href=window.webkitURL.createObjectURL(n):(i.href=window.URL.createObjectURL(n),i.onclick=destroyClickedElement,i.style.display="none",document.body.appendChild(i)),i.click()}},computeBezierActions:function(){var t=lcl.BezierData.getBezierCurveData();this.actionLists=[];for(var e=0,n=t.points.length;e<n;e++){var i=t.points[e],o=i.length/t.length*t.time;i.time=o;var r=cc.moveTo(o,cc.v2(i.x,i.y));this.actionLists.push(r)}},playMoveAnimation:function(){var t,e=this;(this.computeBezierActions(),this.startCountTime(),console.time("time",this.actionLists),this.actionLists.push(cc.callFunc(function(){e.stopCountTime(),console.timeEnd("time")})),this.actionLists.length>1)?this.box.runAction(cc.sequence(this.actionLists)):(t=this.box).runAction.apply(t,i(this.actionLists))},setResolution:function(t,e,n){console.log(t,e,n);var i=Number(t);if(""==t||isNaN(i))return this.showMsg("\u5206\u8fa8\u7387\u53ea\u80fd\u586b\u5199\u6570\u5b57\uff01\uff01\uff01"),void(e.string=this.resolution[n]);this.resolution[n]=i,lcl.BezierData.setResolution(this.resolution.width,this.resolution.height),this.setPaperSize(),lcl.BezierData.init(this.point,this.control,this.node)},setPaperSize:function(){this.paper.width=this.resolution.width,this.paper.height=this.resolution.height},setRunTime:function(t){var e=Number(t);if(""==t||isNaN(e))return this.showMsg("\u8fd0\u884c\u65f6\u95f4\u53ea\u80fd\u586b\u5199\u6570\u5b57\uff01\uff01\uff01"),void(this.runTimeInputBox.string=this.prveRunTime||2);this.prveRunTime=e,lcl.BezierData.setBezierCurveRunTime(e)},setCurveSmoothness:function(t){console.log(t);var e=Number(t);return""==t||isNaN(e)?(this.showMsg("\u66f2\u7ebf\u5e73\u6ed1\u5ea6\u53ea\u80fd\u586b\u5199\u6570\u5b57\uff01\uff01\uff01"),void(this.smoothnessInputBox.string=this.prvePointCount||100)):e<0||e>1e3?(this.showMsg("\u66f2\u7ebf\u5e73\u6ed1\u5ea6\u53d6\u503c\u8303\u56f4\u5728 0 - 1000\uff01"),void(this.smoothnessInputBox.string=this.prvePointCount||100)):(this.prvePointCount=e,void lcl.BezierData.setPointCount(e))},play:function(){lcl.BezierData.saveBezierPath(),this.playMoveAnimation()},showInfoWindow:function(){this.infoWindow.active=!0,this.setNoitce("")},hideInfoWindow:function(){this.infoWindow.active=!1},setNoitce:function(t){this.notice.string=t},showMsg:function(t){var e=this;this.msg.active=!0,this.msg.getComponent(cc.Label).string=t,setTimeout(function(){e.msg&&(e.msg.active=!1)},1e3)},startCountTime:function(){this.isStartRun=!0,this.timeInfo.string=0,this.currentRunTime=0},stopCountTime:function(){this.isStartRun=!1},setCountTimeLabel:function(t){this.currentRunTime=this.currentRunTime+t,this.timeInfo.string="run time: "+this.currentRunTime.toFixed(2)+"s"},showDeleteBtn:function(t){this.deleteBtn.active=!0,this.deleteBtn.setPosition(t)},hideDeleteBtn:function(){this.deleteBtn.active=!1},setMouseLocation:function(t){this.mouseLocation.node.active=!0,this.mouseLocation.node.setPosition(t),this.mouseLocation.string="x:".concat(t.x.toFixed(0)," y:").concat(t.y.toFixed(0))},hideMouseLocation:function(){this.mouseLocation.node.active=!1},setCurveType:function(t){console.log(t),lcl.BezierData.setBezierCurveType(t.node._name)}}),cc._RF.pop()},{"./Bezier":"Bezier","./BezierData":"BezierData","./Enum":"Enum","./EventListener":"EventListener","./NodeEvents":"NodeEvents"}]},{},["Bezier","BezierData","Enum","EventListener","NodeEvents","drawBezier"]);